{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Baukörper</title>

    <!-- hier ist der entscheidende Unterschied: -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
  </head>
  <body id="icm8-2-2" class="gjs-t-body"><div id="iv4hwy-2-2" class="gjs-divider"></div><div data-type-role="flex-row" id="ie9na2-4" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="ijubk9-4" class="gjs-plg-flex-column"><a href="" id="ic9be-2-2-2-3-3" class="gjs-t-button button"><div id="itlw3i-2-2-3-3"><div data-type-icon="" id="i9ezgk-2-4-2-4-3" class="gjs-icon"><svg version="1.0" id="Layer_1-2-4-2-3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier-4-2-4-2-3" stroke-width="0"></g><g id="SVGRepo_tracerCarrier-4-2-4-2-3" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier-4-2-4-2-3"><path fill="#FFFFFFFF" d="M62.79,29.172l-28-28C34.009,0.391,32.985,0,31.962,0s-2.047,0.391-2.828,1.172l-28,28 c-1.562,1.566-1.484,4.016,0.078,5.578c1.566,1.57,3.855,1.801,5.422,0.234L8,33.617V60c0,2.211,1.789,4,4,4h16V48h8v16h16 c2.211,0,4-1.789,4-4V33.695l1.195,1.195c1.562,1.562,3.949,1.422,5.516-0.141C64.274,33.188,64.356,30.734,62.79,29.172z">
    </path></g></svg></div><h1 id="i5cni-3-2-2-2-2-5" class="gjs-t-h1 title">HOME</h1></div></a></div><div data-type-role="flex-column" id="iso6ga-4" class="gjs-plg-flex-column"><div data-type-role="flex-row" id="iui6uq-2-4" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="ir65qj-2-5" class="gjs-plg-flex-column"><div data-type-icon="" id="i9ezgk-2-6-5" class="gjs-icon"><svg fill="#000000" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier-10-5" stroke-width="0"></g><g id="SVGRepo_tracerCarrier-10-5" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier-10-5"><path d="M 16 4 L 15.625 4.15625 L 9.625 6.5625 L 9 6.8125 L 9 13.53125 L 3.59375 15.875 L 3 16.15625 L 3 24.21875 L 3.5 24.53125 L 9.5 27.875 L 9.96875 28.125 L 10.4375 27.90625 L 16 25.125 L 21.5625 27.90625 L 22.03125 28.125 L 22.5 27.875 L 28.5 24.53125 L 29 24.21875 L 29 16.15625 L 28.40625 15.875 L 23 13.53125 L 23 6.8125 L 22.375 6.5625 L 16.375 4.15625 Z M 16 6.1875 L 19.28125 7.46875 L 16 8.75 L 12.71875 7.46875 Z M 11 8.9375 L 15 10.46875 L 15 15.34375 L 11 13.5625 Z M 21 8.9375 L 21 13.5625 L 17 15.34375 L 17 10.46875 Z M 10 15.3125 L 13.625 16.90625 L 10 18.6875 L 6.375 16.875 Z M 22 15.3125 L 25.625 16.875 L 22 18.6875 L 18.375 16.90625 L 19.5 16.40625 Z M 5 18.40625 L 9 20.40625 L 9 25.3125 L 5 23.0625 Z M 27 18.40625 L 27 23.0625 L 23 25.3125 L 23 20.40625 Z M 15 18.46875 L 15 23.375 L 11 25.375 L 11 20.40625 Z M 17 18.46875 L 21 20.40625 L 21 25.375 L 17 23.375 Z">
    </path></g></svg></div><h1 id="i5cni-2-2-3-5" class="gjs-t-h1 title"><span id="i7p69t-5">Gebäude allg.</span></h1></div><div data-type-role="flex-column" id="iw974e-2-4" class="gjs-plg-flex-column"><div data-type-icon="" id="i9ezgk-2-2-2-6" class="gjs-icon"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier-9-5" stroke-width="0"></g><g id="SVGRepo_tracerCarrier-9-5" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier-9-5"><path d="M20,4H4A2,2,0,0,0,2,6V18a2,2,0,0,0,2,2H20a2,2,0,0,0,2-2V6A2,2,0,0,0,20,4ZM10,18a6,6,0,1,1,6-6A6,6,0,0,1,10,18ZM19,8a1,1,0,1,1,1-1A1,1,0,0,1,19,8Zm-4,4.25c0,2.25-1.79,2.3-2.38,1.11a1.61,1.61,0,0,0-.53-.54,1.65,1.65,0,0,0-.71-.26,1.82,1.82,0,0,1-.46.61c1,1.85.6,3.83-1.19,3.83-2.23,0-2.28-1.79-1.1-2.38a1.68,1.68,0,0,0,.54-.52,1.76,1.76,0,0,0,.27-.7,1.61,1.61,0,0,1-.63-.46C7,13.93,5,13.53,5,11.75,5,9.5,6.77,9.44,7.36,10.63a1.52,1.52,0,0,0,.53.54,1.81,1.81,0,0,0,.71.27,1.51,1.51,0,0,1,.46-.62C8.06,9,8.46,7,10.24,7h0c2.25,0,2.3,1.78,1.11,2.38a1.58,1.58,0,0,0-.54.52,1.65,1.65,0,0,0-.26.71,1.7,1.7,0,0,1,.61.45C13,10.06,15,10.46,15,12.25Z"></path><rect width="24" height="24" fill="none"></rect></g></svg></div><h1 id="i5cni-2-2-2-3-5" class="gjs-t-h1 title"><span id="ibjz3q-5">techn. Anlagen</span></h1></div><div data-type-role="flex-column" id="isavpp-2-4" class="gjs-plg-flex-column"><div data-type-icon="" id="i9ezgk-2-5-4" class="gjs-icon"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier-4" stroke-width="0"></g><g id="SVGRepo_tracerCarrier-4" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier-4"><path d="M8 15.9998C7.44772 15.9998 7 16.4475 7 16.9998C7 17.5521 7.44772 17.9998 8 17.9998C8.55228 17.9998 9 17.5521 9 16.9998C9 16.4475 8.55228 15.9998 8 15.9998ZM8 15.9998L8.00707 12M8 16.9998L8.00707 17.0069M20 5C20 6.10457 19.1046 7 18 7C16.8954 7 16 6.10457 16 5C16 3.89543 16.8954 3 18 3C19.1046 3 20 3.89543 20 5ZM12 16.9998C12 19.209 10.2091 20.9998 8 20.9998C5.79086 20.9998 4 19.209 4 16.9998C4 15.9854 4.37764 15.0591 5 14.354L5 6C5 4.34315 6.34315 3 8 3C9.65685 3 11 4.34315 11 6V14.354C11.6224 15.0591 12 15.9854 12 16.9998Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><h1 id="i5cni-2-2-2-2-2-4" class="gjs-t-h1 title"><span id="ikis26-4">Wärmequellen</span></h1></div><div data-type-role="flex-column" id="i56cfg-2-4" class="gjs-plg-flex-column"><div data-type-icon="" id="i9ezgk-2-3-2-4" class="gjs-icon"><svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier-8-4" stroke-width="0"></g><g id="SVGRepo_tracerCarrier-8-4" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier-8-4"><path d="M13 11V1H9L9 11H13Z" fill="#000000"></path><path d="M15 15V13L1 13V15L15 15Z" fill="#000000"></path><path d="M7 5L7 11H3L3 5H7Z" fill="#000000"></path></g></svg></div><h1 id="i5cni-2-2-2-2-3-3-4" class="gjs-t-h1 title"><span id="i8yciv-4">GWP</span></h1></div><div data-type-role="flex-column" id="it8ohg-2-4" class="gjs-plg-flex-column"><div data-type-icon="" id="i9ezgk-2-2-2-2-4" class="gjs-icon"><svg fill="#E79520FF" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg" stroke="#000000"><g id="SVGRepo_bgCarrier-2-2-2-4" stroke-width="0"></g><g id="SVGRepo_tracerCarrier-2-2-2-4" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier-2-2-2-4"><g fill-rule="evenodd"><path d="M1185.46.034V564.74h564.705v1355.294H168.99V.034h1016.47ZM900.508 677.68c-16.829 0-31.963 7.567-42.918 21.007-49.807 59.972-31.398 193.016-18.748 272.075 2.823 17.958.452 36.141-7.228 52.518l-107.86 233.223c-7.905 16.942-20.555 30.608-36.592 39.53-68.104 37.835-182.287 89.675-196.066 182.626-4.97 30.268 5.082 56.357 28.574 79.85 15.925 15.133 35.238 22.7 56.245 22.7 81.43 0 132.819-71.717 188.273-148.517 24.62-34.221 61.666-55.229 102.437-60.876 76.349-10.503 167.83-32.527 223.172-46.983 27.897-7.341 56.358-5.534 83.802 3.162 48.565 15.586 66.975 25.073 122.768 25.073 50.371 0 84.818-11.746 101.534-34.447 13.44-16.828 16.715-39.53 10.164-65.619-11.858-42.804-2.033-89.675-133.044-89.675-29.365 0-57.94 2.824-81.77 6.099-36.819 4.97-73.299-10.955-97.016-40.885-32.301-40.546-65.167-88.433-87.981-123.219-16.151-24.508-21.572-53.986-16.264-83.124 15.473-84.706 18.41-147.615-23.492-206.683-17.619-25.186-41.223-37.835-67.99-37.835Zm397.903-660.808 434.936 434.937h-434.936V16.873Z">
      </path><path d="M791.057 1297.943c92.273-43.37 275.916-65.28 275.916-65.28-92.386-88.998-145.92-215.04-145.92-215.04-43.257 126.607-119.718 264.282-129.996 280.32">
      </path></g></g></svg></div><h1 id="i5cni-2-2-2-2-3-2-2-4" class="gjs-t-h1 title"><span id="iphqmh-4">Ergebnis</span></h1></div></div></div><div data-type-role="flex-column" id="isf3db-4" class="gjs-plg-flex-column"></div></div><header id="iypj-2-2-4" class="head"></header><div data-type-role="flex-row" id="iz3cc-2-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="i3bxl-2-2" class="gjs-plg-flex-column"><form method="get" id="id10y-2-2"></form></div></div><div data-type-role="flex-row" id="ioi2qg-2-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="ikncpe-2-2" class="gjs-plg-flex-column"><h2 id="ibosq-3-2" class="gjs-t-h2 subtitle"><span id="ijw6lr-2-2">Nutzenergiebedarf</span></h2><div id="il0h-4-2" class="card"><div data-type-role="flex-row" id="ijfbr6-2-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="i5og34-2-2" class="gjs-plg-flex-column"><div id="iewwwb-2-2"><div id="id5fuz-2-2"><strong><span id="if4xkh-2-2">- kwh/a</span></strong></div></div></div><div data-type-role="flex-column" id="ivbwvo-2-2" class="gjs-plg-flex-column"><div id="ig6pti-2-2"><div id="i1lhyk-2-2"><strong><span id="ilepeh-2-2">- kwh/m²a</span></strong></div></div></div></div></div><h2 id="ibosq-2-3-2" class="gjs-t-h2 subtitle"><span id="inwx1a-2-2">Energiebedarf</span></h2><div id="il0h-3-3-2" class="card"><div data-type-role="flex-row" id="ij0ekc-2-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="i39cu1-2-2" class="gjs-plg-flex-column"><div id="idepmy-2-2"><div id="ibweov-2-2"><strong><span id="ihm1d4-2-2">- kwh/a</span></strong></div></div></div><div data-type-role="flex-column" id="irzh6e-2-2" class="gjs-plg-flex-column"><div id="ilw34t-2-2"><div id="iwj1qx-2-2"><strong><span id="iz085c-2-2">- kwh/m²a</span></strong></div></div></div></div></div><h2 id="ibosq-2-2-3-2" class="gjs-t-h2 subtitle"><span id="ig81p3-2-2">Primärnergiebedarf</span></h2><div id="il0h-3-2-2-2-2" class="card"><div data-type-role="flex-row" id="izuwvl-2-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="ia3aml-2-2" class="gjs-plg-flex-column"><div id="izzrg9-2-2"><div id="i6p4pj-2-2"><strong><span id="ivn3qd-2-2">- kwh/a</span></strong></div></div></div><div data-type-role="flex-column" id="iwds1a-2-2" class="gjs-plg-flex-column"><div id="i4pigd-2-2"><div id="ius7sb-2-2"><strong><span id="iwlzd1-2-2">- kwh/m²a</span></strong></div></div></div></div></div><h2 id="ibosq-2-2-2-2-2-2" class="gjs-t-h2 subtitle"><span id="islcnl-2-2-2">Strom (Überschuss)</span></h2><div id="il0h-3-2-3-2-2-2" class="card"><div data-type-role="flex-row" id="ijy60i-2-2-2-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="ilex7l-2-2-2-2" class="gjs-plg-flex-column"><div id="iyu3a3-2-2-2-2"><div id="iwlk2m-2-2-2-2"><strong><span id="i0dy85-2-2-2-2">- kwh/a</span></strong></div></div></div><div data-type-role="flex-column" id="iemk91-2-2-2-2" class="gjs-plg-flex-column"><div id="ilcmwe-2-2-2-2"><div id="icivhw-2-2-2-2"><strong><span id="iw5g8h-2-2-2-2">- kwh/m²a</span></strong></div></div></div></div></div><h2 id="ibosq-2-2-2-2-4" class="gjs-t-h2 subtitle"><span id="islcnl-2-4">Sonnenschutz</span></h2><div id="il0h-3-2-3-3-3" class="card"><span id="iw5g8h-2-3-3"><strong id="inm4l1-2">Nein</strong></span></div><h2 id="ibosq-2-2-2-2-3-3" class="gjs-t-h2 subtitle"><span id="islcnl-2-3-3">GWP Var. 1</span></h2><div id="il0h-3-2-3-3-2-2-2" class="card"><span id="iw5g8h-2-3-2-2-2"><strong id="i9chvp-2"> - a</strong></span></div><h2 id="ibosq-2-2-2-2-3-2-2" class="gjs-t-h2 subtitle"><span id="islcnl-2-3-2-2">GWP Var. 2</span></h2><div id="il0h-3-2-3-3-2-3" class="card"><span id="iw5g8h-2-3-2-3"><strong id="i0n29q-2"> - a</strong></span></div></div><div data-type-role="flex-column" id="ijjvog-2-2" class="gjs-plg-flex-column"><div id="il0h-2-2-2" class="card"><div id="ic5r8-2-2-2" class="gjs-custom-code"><h1 id="i5cni-3-2-2-2-2-2-2" class="gjs-t-h1 title">Baukörper</h1><div id="floorplan-wrapper-2-2"><div data-type-role="flex-row" id="ijqgsy-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="i9wgqm-2" class="gjs-plg-flex-column"><span id="isjjhq-2-2-3">Länge</span></div><div data-type-role="flex-column" id="izbxz2-2" class="gjs-plg-flex-column"><input type="text" id="iw9ryk-2"/></div></div><div data-type-role="flex-row" id="irzocg-5" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="iry2we-5" class="gjs-plg-flex-column"><span id="isjjhq-2-2-2-5">Breite</span></div><div data-type-role="flex-column" id="im9na2-5" class="gjs-plg-flex-column"><input type="text" id="iy8dpc-5"/></div></div><div data-type-role="flex-row" id="irzocg-4-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="iry2we-4-2" class="gjs-plg-flex-column"><span id="isjjhq-2-2-2-4-2">Geschossanzahl</span></div><div data-type-role="flex-column" id="im9na2-4-2" class="gjs-plg-flex-column"><input type="text" id="iy8dpc-4-2"/></div></div><div data-type-role="flex-row" id="irzocg-3-2" class="gjs-plg-flex-row"><div data-type-role="flex-column" id="iry2we-3-2" class="gjs-plg-flex-column"><span id="isjjhq-2-2-2-3-2">Personendichte [m²/Personen]</span></div><div data-type-role="flex-column" id="im9na2-3-2" class="gjs-plg-flex-column"><input type="text" id="iy8dpc-3-2"/></div></div><div id="iv4hwy-3-2" class="gjs-divider"></div></div><script src="https://cdn.babylonjs.com/babylon.js"></script><script>
            (function () {
              const canvas = document.getElementById("floorplan-canvas");
              const engine = new BABYLON.Engine(canvas, true);
              const scene = new BABYLON.Scene(engine);
              scene.clearColor = new BABYLON.Color3(1, 1, 1);

              const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2.5, Math.PI / 3, 50, BABYLON.Vector3.Zero(), scene);
              camera.attachControl(canvas, true);

              const directionalLight = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-1, -2, -1), scene);
              directionalLight.position = new BABYLON.Vector3(20, 40, 20);
              directionalLight.intensity = 1.0;

              const shadowGenerator = new BABYLON.ShadowGenerator(2048, directionalLight);
              shadowGenerator.useBlurExponentialShadowMap = true;
              shadowGenerator.blurKernel = 16;

              function berechneSkalierung(room) {
                return room.customProps?.breite > 0 ? room.width / room.customProps.breite : 1;
              }

              function getGrayColor(value) {
                const grayValue = Math.max(0, Math.min(1, value));
                return new BABYLON.Color3(grayValue, grayValue, grayValue);
              }

              const geschossHoehe = 2.2;
              let aktuelleHoehe = 0;
              let geschossGruppen = {};

              const groundSize = 100;
              const ground = BABYLON.MeshBuilder.CreateGround("bodenplatte", {
                width: groundSize,
                height: groundSize
              }, scene);
              ground.position.y = 0.01;
              ground.receiveShadows = true;

              const gradientSize = 512;
              const texture = new BABYLON.DynamicTexture("gradientTex", { width: gradientSize, height: gradientSize }, scene, false);
              const ctx = texture.getContext();
              const gradient = ctx.createRadialGradient(gradientSize / 2, gradientSize / 2, gradientSize * 0.1, gradientSize / 2, gradientSize / 2, gradientSize * 0.5);
              gradient.addColorStop(0, "rgba(150,150,150,0.3)");
              gradient.addColorStop(1, "rgba(255,255,255,0)");
              ctx.fillStyle = gradient;
              ctx.fillRect(0, 0, gradientSize, gradientSize);
              texture.update();

              const mat = new BABYLON.StandardMaterial("bodenMat", scene);
              mat.diffuseTexture = texture;
              mat.opacityTexture = texture;
              mat.backFaceCulling = false;
              mat.disableLighting = true;
              ground.material = mat;

              function erstelle3DFloorPlan(data) {
                scene.meshes.forEach(m => { if (m.name !== "bodenplatte") m.dispose(); });
                scene.transformNodes.forEach(n => { if (n.name !== "bodenplatte") n.dispose(); });
                scene.textures.forEach(t => { if (t.name !== "gradientTex") t.dispose(); });

                geschossGruppen = {};
                aktuelleHoehe = 0;

                const gruppen = {};
                Object.entries(data).forEach(([geschossName, raeume]) => {
                  const gruppe = new BABYLON.TransformNode(`gruppe_${geschossName}`, scene);
                  raeume.forEach(room => {
                    const scale = berechneSkalierung(room);
                    const breite = room.width / scale;
                    const tiefe = room.height / scale;
                    const hoehe = geschossHoehe;

                    const box = BABYLON.MeshBuilder.CreateBox("raum", { width: breite, height: hoehe, depth: tiefe }, scene);
                    box.position.x = room.left / scale + breite / 2;
                    box.position.z = -(room.top / scale + tiefe / 2);
                    box.position.y = aktuelleHoehe + hoehe / 2;
                    box.parent = gruppe;

                    const mat = new BABYLON.StandardMaterial("mat", scene);
                    mat.diffuseColor = getGrayColor(0.5);
                    mat.alpha = 0.7;
                    box.material = mat;

                    const dynTex = new BABYLON.DynamicTexture("dynTex", 512, scene, true);
                    dynTex.drawText(room.text || "", null, 256, "bold 60px Arial", "black", "transparent", true);

                    const textMat = new BABYLON.StandardMaterial("textMat", scene);
                    textMat.diffuseTexture = dynTex;
                    textMat.emissiveColor = new BABYLON.Color3(0, 0, 0);
                    textMat.backFaceCulling = false;
                    textMat.diffuseTexture.hasAlpha = true;

                    const textPlane = BABYLON.MeshBuilder.CreatePlane("textPlane", {
                      width: breite * 0.9,
                      height: tiefe * 0.9
                    }, scene);
                    textPlane.position = new BABYLON.Vector3(box.position.x, box.position.y + 0.01, box.position.z);
                    textPlane.rotation = new BABYLON.Vector3(Math.PI / 2, 0, 0);
                    textPlane.material = textMat;
                    textPlane.parent = gruppe;
                  });
                  gruppen[geschossName] = gruppe;
                  aktuelleHoehe += geschossHoehe;
                });

                updateUI(gruppen);
              }

              function updateUI(gruppen) {
                const ui = document.getElementById("floorplan-ui");
                const buttons = ui.querySelectorAll('button');
                buttons.forEach(button => button.remove());

                Object.keys(gruppen).forEach(name => {
                  const btn = document.createElement("button");
                  btn.textContent = `☑ ${name}`;
                  btn.dataset.name = name;
                  btn.dataset.visible = "true";
                  btn.className = "fp-button";
                  btn.style.margin = "5px";
                  btn.onclick = () => {
                    const gruppe = gruppen[name];
                    const visible = btn.dataset.visible === "true";
                    gruppe.setEnabled(!visible);
                    btn.dataset.visible = (!visible).toString();
                    btn.style.backgroundColor = visible ? "#aaa" : "#1976d2";
                    btn.textContent = visible ? `☐ ${name}` : `☑ ${name}`;
                  };
                  ui.appendChild(btn);
                });

                const allBtn = document.createElement("button");
                allBtn.textContent = "Alle zeigen";
                allBtn.className = "fp-button";
                allBtn.style.margin = "5px";
                allBtn.onclick = () => {
                  Object.entries(gruppen).forEach(([name, gruppe]) => {
                    gruppe.setEnabled(true);
                    const btn = [...ui.children].find(b => b.dataset.name === name);
                    if (btn) {
                      btn.dataset.visible = "true";
                      btn.textContent = `☑ ${name}`;
                      btn.style.backgroundColor = "#1976d2";
                    }
                  });
                };
                ui.appendChild(allBtn);
              }

              document.getElementById("floorplan-fileInput").addEventListener("change", function (event) {
                const file = event.target.files[0];
                if (file && file.type === "application/json") {
                  const reader = new FileReader();
                  reader.onload = function (e) {
                    try {
                      const jsonData = JSON.parse(e.target.result);
                      erstelle3DFloorPlan(jsonData);
                    } catch (error) {
                      alert("Fehler beim Verarbeiten der JSON-Datei.");
                    }
                  };
                  reader.readAsText(file);
                } else {
                  alert("Bitte eine gültige JSON-Datei auswählen.");
                }
              });

              engine.runRenderLoop(() => scene.render());
              window.addEventListener("resize", () => engine.resize());
            })();
</script>

<!-- Fensterflächen- und g-Wert-Eingabe -->
<div data-type-role="flex-row" id="ircneqg" class="gjs-plg-flex-row">
  <div data-type-role="flex-column" id="if7587r" class="gjs-plg-flex-column"></div>

  <div data-type-role="flex-column" id="i39c31s" class="gjs-plg-flex-column">
    <span id="isjjhq-2-2-2-2-2-2">Fensterfläche</span>
  </div>

  <div data-type-role="flex-column" id="i53mnq1" class="gjs-plg-flex-column">
    <span id="isjjhq-2-2-2-2-2-3">g-Wert Fenster</span>
  </div>
</div>

<div data-type-role="flex-row" id="i4k9l3a" class="gjs-plg-flex-row">
  <div data-type-role="flex-column" id="iry2we-2-2-8" class="gjs-plg-flex-column">
    <span id="isjjhq-2-2-2-2-2-8">Nord</span>
  </div>
  <div data-type-role="flex-column" id="i376w3l" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-8"/>
  </div>
  <div data-type-role="flex-column" id="i8pyhjh" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-4-5"/>
  </div>
</div>

<div data-type-role="flex-row" id="i331dyr" class="gjs-plg-flex-row">
  <div data-type-role="flex-column" id="iry2we-2-2-7" class="gjs-plg-flex-column">
    <span id="isjjhq-2-2-2-2-2-7">Süd</span>
  </div>
  <div data-type-role="flex-column" id="ix3ngyd" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-7"/>
  </div>
  <div data-type-role="flex-column" id="igvoi6k" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-4-4"/>
  </div>
</div>

<div data-type-role="flex-row" id="i8c2zac" class="gjs-plg-flex-row">
  <div data-type-role="flex-column" id="iry2we-2-2-6" class="gjs-plg-flex-column">
    <span id="isjjhq-2-2-2-2-2-6">West</span>
  </div>
  <div data-type-role="flex-column" id="iw1quq5" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-6"/>
  </div>
  <div data-type-role="flex-column" id="ifi1mxx" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-4-3"/>
  </div>
</div>

<div data-type-role="flex-row" id="id1bm32" class="gjs-plg-flex-row">
  <div data-type-role="flex-column" id="iry2we-2-2-5" class="gjs-plg-flex-column">
    <span id="isjjhq-2-2-2-2-2-5">Ost</span>
  </div>
  <div data-type-role="flex-column" id="i99yrml" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-5"/>
  </div>
  <div data-type-role="flex-column" id="i8ktaqg" class="gjs-plg-flex-column">
    <input type="text" id="iy8dpc-2-2-4-2"/>
  </div>
</div>

</div>
</div>
</div>

<!-- Sidebar: einfache / komplexe Eingabe -->

  <!-- 3) Jetzt kommt die Sidebar außerhalb der Card -->
  <div data-type-role="flex-column" id="i9g2x7-2-2" class="gjs-plg-flex-column">
    <div id="iv4hwy-4" class="gjs-divider"></div>

    <a href="{% url 'baukoerper_kp' %}" id="ic9be-2-2-3" class="gjs-t-button button">
      <div id="itlw3i-2-3">
        <div id="i3b05g-3">
          <div>einfache / komplexe Eingabe</div>
        </div>
      </div>
    </a>

    <div id="iv4hwy-3-2-4" class="gjs-divider"></div>

    <h1 id="i5cni-3-2-2-2" class="gjs-t-h1 title">Eingabe Hilfe</h1>
    <span id="isjjhq-2-3">
      Geben Sie nacheinander alle Bauteile der <strong id="i2oy16-2">thermischen Gebäudehülle</strong> ein. 
      Hierzu geben Sie die einzelnen Bauteilschichten von<strong> innen nach außen</strong> an. 
      Beachten Sie die Wärmeübergangswiderstände bei *1.
    </span>
  </div>

</div>
<footer id="ietlh-2-2">
  <div data-type-role="flex-row" id="iz3mn-2-2" class="gjs-plg-flex-row">
    <!-- Logo ganz links -->
    <div data-type-role="flex-column" id="iy3ds-2-2" class="gjs-plg-flex-column">
      <img
        src="{% static 'images/Logo.png' %}"
        alt="Mein Logo"
        id="ies6-2-2"
        class="logo"
      />
    </div>
    <!-- Back-Button -->
    <div data-type-role="flex-column" id="ilnji-2-2" class="gjs-plg-flex-column">
      <a href="{% url 'allg_angaben' %}" class="gjs-t-button button">
        <div>Back</div>
      </a>
    </div>
    <!-- Next-Button -->
    <div data-type-role="flex-column" id="i7lnt-2-2" class="gjs-plg-flex-column">
    <a href="{% url 'bauteil' %}" class="gjs-t-button button">
        <div>
        Next
        </div>
    </a>
    </div>
    <!-- leerer Platzhalter rechts -->
    <div data-type-role="flex-column" id="idpkn-2-2" class="gjs-plg-flex-column"></div>
  </div>
</footer>
<script>
    // 1) Alle Inputs mit "name" einsammeln
    const inputs = document.querySelectorAll("input[name]");
    inputs.forEach(i => i.addEventListener("input", update));

    // 2) Update‐Routine
    function update() {
      const params = new URLSearchParams();
      inputs.forEach(i => params.set(i.name, i.value));

      fetch(`/api/berechnung/?${params}`)
        .then(r => r.json())
        .then(data => {
          // passe IDs an Deine Ausgabefelder an:
          document.getElementById("ausgabe_hoehe").textContent   = data.gebaeudedaten.hoehe;
          document.getElementById("ausgabe_volumen").textContent = data.gebaeudedaten.volumen;
          document.getElementById("ausgabe_bgf").textContent     = data.gebaeudedaten.bgf;
          document.getElementById("ausgabe_nf").textContent      = data.gebaeudedaten.nf;
          // … und so weiter für alle anderen Etappen …
        })
        .catch(console.error);
    }

    // einmal initial auslösen
    update();
  </script>
</body>
</html>